# دليل إعداد نظام الدفع بالفيزا - Payment Setup Guide

## الخطوات المطلوبة لإعداد الدفع الحقيقي

### 1. إنشاء حساب Stripe

Stripe هو وسيط الدفع الذي يتعامل مع البنوك نيابة عنك. لا تحتاج للتعامل مباشرة مع البنك.

**الخطوات:**
1. اذهب إلى [https://dashboard.stripe.com/register](https://dashboard.stripe.com/register)
2. سجل حساب جديد (مجاني)
3. أكمل معلومات الشركة/المتجر
4. بعد التسجيل، ستجد مفاتيح API في قسم "Developers" > "API keys"

### 2. الحصول على مفاتيح Stripe

**للاختبار (Test Mode):**
- `pk_test_...` - المفتاح العام (Publishable Key)
- `sk_test_...` - المفتاح السري (Secret Key)

**للإنتاج (Live Mode):**
- `pk_live_...` - المفتاح العام
- `sk_live_...` - المفتاح السري

### 3. إعداد متغيرات البيئة

أنشئ ملف `.env.local` في جذر المشروع وأضف:

```env
STRIPE_SECRET_KEY=sk_test_...
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_...
```

### 4. تفعيل الحساب للدفع الحقيقي

**للانتقال من وضع الاختبار إلى الإنتاج:**

1. **أكمل معلومات الحساب:**
   - اذهب إلى "Settings" > "Account details"
   - أكمل معلومات الشركة/المتجر
   - أضف معلومات البنك (حساب بنكي لاستقبال الأموال)

2. **أضف حساب بنكي:**
   - اذهب إلى "Settings" > "Bank accounts and scheduling"
   - أضف رقم حسابك البنكي
   - Stripe سيرسل مبالغ صغيرة للتحقق من الحساب

3. **أكمل التحقق:**
   - أضف معلومات الهوية (بطاقة شخصية أو رخصة قيادة)
   - أكمل معلومات الضرائب
   - انتظر موافقة Stripe (عادة 1-2 يوم عمل)

4. **فعّل وضع الإنتاج:**
   - بعد الموافقة، استبدل المفاتيح في `.env.local`:
   ```env
   STRIPE_SECRET_KEY=sk_live_...
   NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_live_...
   ```

### 5. ما الذي يحدث مع البنك؟

**Stripe يتعامل مع البنوك نيابة عنك:**
- ✅ Stripe لديه اتفاقيات مع البنوك العالمية
- ✅ لا تحتاج لفتح حساب خاص مع البنك
- ✅ Stripe يستقبل المدفوعات ثم يحولها لحسابك البنكي
- ✅ الرسوم: حوالي 2.9% + $0.30 لكل معاملة (في الولايات المتحدة)

**في مصر:**
- Stripe متاح في مصر ولكن قد تحتاج لشركة مسجلة
- بدائل محلية: Paymob، Fawry، أو PayTabs
- يمكنك استخدام نفس الكود مع تعديلات بسيطة

### 6. اختبار الدفع

**بطاقات اختبار Stripe:**
- رقم البطاقة: `4242 4242 4242 4242`
- تاريخ الانتهاء: أي تاريخ في المستقبل (مثل 12/25)
- CVV: أي 3 أرقام (مثل 123)
- الرمز البريدي: أي 5 أرقام (مثل 12345)

### 7. الأمان

- ✅ جميع بيانات البطاقات مشفرة
- ✅ لا يتم تخزين بيانات البطاقات على خوادمك
- ✅ Stripe متوافق مع PCI DSS (معيار أمان البطاقات)
- ✅ 3D Secure متاح تلقائياً

### 8. استقبال الأموال

- الأموال تصل لحسابك البنكي خلال 2-7 أيام عمل
- يمكنك تتبع جميع المعاملات من لوحة تحكم Stripe
- Stripe يرسل إشعارات لكل معاملة

## ملاحظات مهمة

⚠️ **للاختبار فقط:** استخدم المفاتيح التي تبدأ بـ `test_`
⚠️ **للإنتاج:** استخدم المفاتيح التي تبدأ بـ `live_` فقط بعد تفعيل الحساب
⚠️ **الأمان:** لا تشارك `STRIPE_SECRET_KEY` أبداً في الكود المصدري

## الدعم

- [وثائق Stripe](https://stripe.com/docs)
- [دعم Stripe](https://support.stripe.com)
- [لوحة تحكم Stripe](https://dashboard.stripe.com)

